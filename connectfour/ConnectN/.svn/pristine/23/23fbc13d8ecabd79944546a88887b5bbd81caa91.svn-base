package is207.connectn.gui;

import is207.connectn.game.Game;
import is207.connectn.game.GameManager.GameChange;
import is207.connectn.game.GameManager.GameListener;
import is207.connectn.game.GameParams;
import is207.connectn.game.GameState.Move;
import java.awt.Color;
import java.awt.Dimension;
import java.awt.Graphics;
import java.awt.Graphics2D;
import java.awt.GridLayout;
import java.awt.geom.Ellipse2D;
import java.awt.geom.Rectangle2D;
import javax.swing.JComponent;
import javax.swing.JPanel;



/**
 * This class displays the game state on the screen. .
 *
 * @author evenal
 */
public class Board extends JPanel implements GameListener
{

    public static final int CELL_GAP = 0;
    public static final Color EMPTY_COLOUR = Color.DARK_GRAY;
    public static final Color PLAYER1_COLOUR = Color.RED;
    public static final Color PLAYER2_COLOUR = Color.BLUE;

    private static final int CELL_SIZE = 50; // cell size
    private static final int CELL_BORDER = 5; // distance between cells

    private final GameParams gameParams;
    private final Cell[][] board;

    public Board(GameParams gameParams) {
        this.gameParams = gameParams;
        GridLayout layout = new GridLayout(gameParams.getRows(),
                                           gameParams.getCols(),
                                           CELL_GAP,
                                           CELL_GAP);
        setLayout(layout);

        board = new Cell[gameParams.getRows()][gameParams.getCols()];
        for (int r = 0; r < gameParams.getRows(); r++) {
            for (int c = 0; c < gameParams.getCols(); c++) {
                board[r][c] = new Cell();
            }
        }
        for (int r = gameParams.getRows(); r > 0; r--) {
            for (int c = 0; c < gameParams.getCols(); c++) {
                add(board[r - 1][c]);
            }
        }
        repaint();
    }

    public void reset() {
        for (int r = 0; r < gameParams.getRows(); r++) {
            for (int c = 0; c < gameParams.getCols(); c++) {
                board[r][c].colour = EMPTY_COLOUR;
            }
        }
        repaint();
    }

    public void update(Move m) {
        board[m.row][m.col].colour = m.p.getColour();
        repaint();
    }

    public void gameChanged(Game game, GameChange reason) {
        if (reason == GameChange.MOVE) {
            update(game.getGameState().getLastMove());
        }
        else if (reason == GameChange.NEW_GAME) {
            reset();
        }

    }



    private class Cell extends JComponent
    {

        int row;
        int col;
        Color colour;

        public Cell() {
//            setBackground(Color.);
            colour = EMPTY_COLOUR;
            Dimension dim = new Dimension(CELL_SIZE, CELL_SIZE);
            setMinimumSize(dim);
            setMaximumSize(dim);
            setPreferredSize(dim);
            setSize(dim);
        }

        public void paintComponent(Graphics g) {
            Graphics2D g2 = (Graphics2D) g;
            super.paintComponent(g);

            g2.setPaint(getBackground());
            g2.fill(new Rectangle2D.Double(0, 0, CELL_SIZE, CELL_SIZE));

            Ellipse2D disc = new Ellipse2D.Double();
            disc.setFrame(new Rectangle2D.Double(CELL_BORDER, CELL_BORDER,
                                                 CELL_SIZE - 2 * CELL_BORDER - 1, CELL_SIZE - 2 * CELL_BORDER - 1));
            g2.setPaint(colour);
            g2.fill(disc);

        }

    }
}
